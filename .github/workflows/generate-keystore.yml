name: Generate Keystore

on:
  workflow_dispatch:

jobs:
  generate-keystore:
    runs-on: ubuntu-latest

    steps:
      - name: Generate Keystore
        run: |
          # 使用固定密码生成 keystore
          KEYSTORE_PASS="WeatherFree2025!FightMonster"
          KEY_PASS="WeatherFree2025!FightMonster"
          
          keytool -genkey -v \
            -keystore release.keystore \
            -alias weatherfree \
            -keyalg RSA \
            -keysize 2048 \
            -validity 10000 \
            -storepass "$KEYSTORE_PASS" \
            -keypass "$KEY_PASS" \
            -dname "CN=WeatherFree, OU=Development, O=FightMonster, L=City, ST=State, C=US"
          
          echo "=== Keystore generated successfully ==="
          echo "Store file: release.keystore"
          echo "Alias: weatherfree"
          echo "Keystore size: $(stat -c%s release.keystore) bytes"

      - name: Encode to Base64
        run: |
          echo "KEYSTORE_BASE64=$(base64 -w 0 release.keystore)" >> $GITHUB_ENV

      - name: Output Base64
        run: |
          echo "========================================"
          echo "Copy this base64 string to GitHub Secrets:"
          echo "Secret name: KEYSTORE_BASE64"
          echo "========================================"
          echo "$KEYSTORE_BASE64"
          echo "========================================"

      - name: Save Passwords to File
        run: |
          echo "Store these passwords safely:"
          echo "KEYSTORE_PASSWORD=WeatherFree2025!FightMonster"
          echo "KEY_PASSWORD=WeatherFree2025!FightMonster"
